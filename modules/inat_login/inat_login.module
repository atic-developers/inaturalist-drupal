<?php
  /**
   * iNaturalist login module
   * Copyright 2014 Projecte Ictineo SCCL (www.projecteictineo.com)
   * aGPLv3
   */

/**
 * Implements hook_block_info()
 */
function inat_login_block_info() {
  $blocks['inat_login'] = array (
    'info' => t('iNaturalist login block'),
    'cache' => DRUPAL_CACHE_PER_ROLE,
  );
  $blocks['inat_usrinfo'] = array (
    'info' => t('iNaturalist logged user information'),
    'cache' => DRUPAL_CACHE_PER_ROLE,
  );
  return $blocks;
}

/**
 * Implements hook_block_view()
 * https://api.drupal.org/api/drupal/modules%21block%21block.api.php/function/hook_block_view/7
 */
function inat_login_block_view($delta = '') {
  switch($delta) {
    case 'inat_login':
      $block['subject'] = t('iNaturalist login');
      $block['content'] = inat_login_login_content($delta);
    break;
    case 'inat_usrinfo':
      $block['subject'] = t('iNaturalist user information');
      $block['content'] = inat_login_usrinfo_content($delta);
    break;
  }
  return $block;
}


/**
 * Helper functions [no hooks]
 */

/**
 * this function returns string o renderable array
 * with the block content for inat_login block
 */
function inat_login_login_content($delta) {
  // Settings to pass into javascript file with the login url
  //drupal_add_js(array('sso_moodle' =>array('login_url' =>variable_get('moodle_login_url',''))), 'setting');

  $form['#method'] = 'post';
  $form['#attributes'] = array( 'id' => 'sso-moodle-login-form' );
  // Hem recuperat codi passat, aquesta part no ens interesa.
  //$form['#attached'] = array (
    //'js' => array (
      //'type' => 'file',
      //'data' => drupal_get_path('module','sso_moodle') . '/js/ajax.js',
    //),
    //'css' => array (
      //'type' => 'file',
      //'data' => drupal_get_path('module','sso_moodle') . '/css/block.css',
    //),
  //);
  $form['description'] = array(
    '#type' => 'item',
    '#title' => t('Enter your moodle user/passwd'),
    '#description' => t('Enter your user'),
  );
  $form['username'] = array(
    '#type' => 'textfield',
    '#title' => t('Username'),
    '#required' => TRUE,
  );
  $form['password'] = array(
    '#type' => 'password',
    '#title' => t('Password'),
    '#required' => TRUE,
  );
  $form['log'] = array(
    '#type' => 'button',
    '#value' => t('Login'),
  );
  return $form;
  
  
  //return 'contingut dummy pel bloc de login';
}

/**
 * this function returns string o renderable array
 * with the block content for inat_usrinfo block
 */
function inat_login_usrinfo_content($delta) {
  return 'contingut dumi pel bloc de informacio de lusuari';
}
